---
when:
    branch: "main"
    event: "push"
steps:
    - name: "Run doxygen"
      image: "git.kalehmann.de/infrastructure/dockerimages/doxygen:latest"
      commands:
          - "doxygen"
    - name: "Publish documentation"
      image: "git.kalehmann.de/infrastructure/dockerimages/lftp:latest"
      commands:
          - 'lftp -e "
                 set ftp:ssl-force true;
                 set ssl:verify-certificate yes;
                 open -u $${USER},$${PASSWORD} $${SERVER};
                 mirror
                     --reverse
                     --delete
                     $(pwd)/_html
                     attiny85-demo-board;
                 exit;"'
      environment:
          USER:
              from_secret: 'ftp_user'
          PASSWORD:
              from_secret: 'ftp_password'
          SERVER:
              from_secret: 'ftp_server'
      depends_on:
          - 'Run doxygen'
...
